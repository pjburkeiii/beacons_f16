import jsonimport requestsimport datetimefrom flask import Flask, jsonify, requestapp = Flask(__name__)# YOUR CANVAS KEYcanvasKey = '4511~U5CTjXuSLJKdaAoFTSRv7GeIFd1lGzDYVohzKHeHqUbfW1MTVQ0L1kFX1Fzkjx9Y'courseID_1 = 36417 #exploration of beacons#static dataitems = { 'b1cfd7baf1349880': 'pi', '0daad9c90f98e60d': 'arduino', 'uuid3': 'item3', 'uuid4': 'item4' }usersUUID = 'b9407f30f5f8466eaff925556b57fe6d'users = { 'b9407f30f5f8466eaff925556b57fe6d-13137-13952': 16177, 'b9407f30f5f8466eaff925556b57fe6e-41822-33333': 32159 }# users: ben, jordancourses = { 'F3F73797-8720-45A1-9C6A-B105E24D1484~1000~1012': 36417 }# courses: exploration of beaconsdef assoc_itemUUID(uuid):	return items[uuid]def assoc_courseUUID(uuid, major, minor):	lookupStr = str(uuid) + '~' + str(major) + '~' + str(minor)	if ( lookupStr in courses.keys() ):		return courses[lookupStr]	else:		return Nonedef assoc_userUUID(uuid, major, minor):	lookupStr = str(uuid) + '-' + str(major) + '-' + str(minor)	if( lookupStr in users.keys() ):		return users[lookupStr]	else:		return Nonedef get_user_id():	op = {'access_token': canvasKey}	req = requests.get('https://canvas.vt.edu/api/v1/users/self/profile', params=op)	return req.json()['id']def get_user_name(canvasID):	username = None	op = {'access_token': canvasKey}	req = requests.get('https://canvas.vt.edu/api/v1/courses/' + str(courseID_1) + '/users', params=op)	for i in range(0, len(req.json())):		if(req.json()[i]['id'] == canvasID):			username = req.json()[i]['name']	return usernamedef get_file_id(courseID, folderPath, fileName):	id = 0	op = {'access_token': canvasKey}	# get folder ID from path	req1 = requests.get( ('https://canvas.vt.edu/api/v1/courses/' + str(courseID) + 			'/folders/by_path' + folderPath ), params=op)	# list files in folder	req2 = requests.get( ('https://canvas.vt.edu/api/v1/folders/' + 		str(req1.json()[len(req1.json()) - 1]['id']) + '/files' ), params=op)	# get file ID from list	for i in range(0, len(req2.json())):		if(req2.json()[i]['display_name'] == fileName):			id = req2.json()[i]['id']	return iddef get_file_url(fileID):	op = {'access_token': canvasKey}	req = requests.get('https://canvas.vt.edu/api/v1/files/' + str(fileID), params=op)	if( 'url' in req.json().keys() ):		return req.json()['url']	else:		return None# function looks at the groups for the specified user and returns the groups name (str) # of the group for the respective coursedef get_group_name(courseID, userID):	group = ''	op = {'access_token': canvasKey}	req = requests.get('https://canvas.vt.edu/api/v1/users/' + str(userID) + '/groups/', params=op)	for i in range(0, len(req.json())):		if(req.json()[i]['course_id'] == courseID):			group = req.json()[i]['name']	return group@app.route('/get_agenda', methods=['GET'])def return_agenda():	data = {}	# lookup uuid to student id	uuid = request.args.get('uuid')	major = request.args.get('major')	minor = request.args.get('minor')	userID = request.args.get('canvas_id')	print (uuid, major, minor)	print userID	if( (uuid == None or major == None or minor == None) ):		data = {'error': 'invalid parameter set; requires uuid, major, and minor'}	else:		courseID = assoc_courseUUID(uuid, major, minor)		url = get_file_url(get_file_id(courseID, '/demo/', 'syllabus.pdf'))		grp = get_group_name(courseID, userID)		data = { 'url': str(url), 'group_name': str(grp) }	return jsonify(**data)@app.route('/get_item', methods=['GET'])def return_item():	data = {}	uuid = request.args.get('uuid')	if( (uuid == None) ):		data = {'error': 'invalid parameter set; requires uuid'}	else:		itemID = assoc_itemUUID(uuid)		# TODO replace these with proper path and files once uploaded		# add front and back		# ***		i_top =    get_file_url(get_file_id(courseID_1, ('/' + itemID + '/'), 'top.jpg'))		i_bottom = get_file_url(get_file_id(courseID_1, ('/' + itemID + '/'), 'bottom.jpg'))		i_right =  get_file_url(get_file_id(courseID_1, ('/' + itemID + '/'), 'right.jpg'))		i_left =   get_file_url(get_file_id(courseID_1, ('/' + itemID + '/'), 'left.jpg'))		i_front =  get_file_url(get_file_id(courseID_1, ('/' + itemID + '/'), 'front.jpg'))		i_back =   get_file_url(get_file_id(courseID_1, ('/' + itemID + '/'), 'back.jpg'))		data = { 'top': str(i_top), 'bottom': str(i_bottom), 'right': str(i_right),			'left': str(i_left), 'front': str(i_front), 'back': str(i_back) }	return jsonify(**data)@app.route('/get_user', methods=['GET'])def return_user():	data = {}	# lookup uuid to student id	uuid = request.args.get('uuid')	major = request.args.get('major')	minor = request.args.get('minor')	if( (uuid == None or major == None or minor == None) ):		data = {'error': 'invalid parameter set; requires uuid, major, and minor'}	elif( assoc_userUUID(uuid, major, minor) == None ):		data = {'error': 'student not found'}	else:		user = assoc_userUUID(uuid, major, minor)		username = get_user_name(user)		data = {'id': user, 'username': username}	return jsonify(**data)print get_file_url(get_file_id(courseID_1, '/demo/', 'test_file.txt'))print get_group_name(courseID_1, 'self')print str(datetime.datetime.now().date())app.run(host='208.113.133.165', port=5000)